---
title: "Taylor Swift Song Analysis: What Makes Good and Bad Songs?"
author: "Arvind Ramakrishnan, Jason Matthew Suhari, Jason Ray, Tay Jia Jun Jeremy"
date: "`r Sys.Date()`"
output: html_document
---

## Introduction

### Background

This project analyzes Taylor Swift's albums that were released up until 2023, with the latest being *1989 (Taylor's Version)*. 

The [dataset](https://github.com/rfordatascience/tidytuesday/blob/master/data/2023/2023-10-17/readme.md) is sourced from [TidyTuesday](https://github.com/rfordatascience/tidytuesday), featuring the following key variables:

1. **`album_name`**: Name of the album that a specific song belongs to

2. **`danceability`**: A metric of how suitable a song is for dancing (0 - 1)

3. **`energy`**: A metric of how intense and energetic a song is (0 - 1)

4. **`loudness`**: Measure of loudness in decibels (dB)

5. **`speechiness`**: A metric of how many words are spoken in a song (0 - 1)

6. **`acousticness`**: A metric of whether or not a song is acoustic, meaning void of electric amplification (0 - 1)

7. **`valence`**: A metric of how musically positive (i.e., happy, cheerful) a song is (0 - 1)

8. **`tempo`**: The overall estimated tempo of the track, measured in BPM

9. **`album_release`**: The release date of the album, meaning some songs will have the same value for this column

10. **`metacritic_score`**: A score out of 100 that represents the average critical rating for the entire album, meaning some songs will have the same value for this column

11. **`user_score`**: A score out of 100 that represents the average user rating for the entire album, meaning some songs will have the same value for this column


### Main Question

<<<<<<< HEAD
**What makes a good or bad Taylor Swift album?**
=======
**What are the key differences, in terms of musical features, between the songs of a highly rated album and relatively lower rated album of Taylor Swift?**
>>>>>>> Arvind

### Sub-Questions
1.) How does the metacritic score and user score differ for each Taylor Swift album and what are the good and bad albums?

2.) Insert sub-question #2 here

3.) Insert sub-question #3 here

## Data Parsing and Initialization

```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE, include = TRUE,
                      fig.align = "center",  out.width = "80%")
```

### (DEBUG) Package Installations (For members only, to remove later)
```{r}
# install.packages("ggplot2")
# install.packages("dplyr")
# install.packages("tidyverse")
# install.packages("taylor")
# install.packages("tidytuesdayR")
# install.packages("viridis")
```

### Library Imports
```{r}
library(ggplot2)
library(dplyr)
library(taylor)
library(tidyverse)
library(viridis)
library(lubridate)
# add more here ltr
```

### Data Ingestion & Cleaning
<<<<<<< HEAD
```{r}
data <- tidytuesdayR::tt_load('2023-10-17')
cols_to_select <- c("album_name", "danceability", "energy", "loudness", "speechiness", "acousticness", "liveness", "valence", "tempo")
=======

The main Taylor Swift datasets that we will be using in our data analysis are the `taylor_albums` and `taylor_album_songs` datasets. We will be omitting the `taylor_all_songs` dataset from the scope of our project since the key variables that we intend to use for our visualizations and analysis are contained in the `taylor_album_songs` and these variables are also repeated in the `taylor_all_songs` dataset and therefore is redundant to the primary objective of our data analysis. **Section 1** which entails **Visualization 1** will only utilize the `taylor_albums` dataset, whereas the `taylor_album_songs` left joined with the `taylor_albums` dataset will be used for anaylsis in **Section 2** and **Section 3** and their visualizations respectively.

The transformation and cleaning for `taylor_albums` dataset will be done in **Section 1** itself. In this part, we first transform and clean the `taylor_album_songs` dataset by first selecting and keeping only the `album_name`, `danceability`, `energy`, `loudness`, `speechiness`, `acousticness`, `valence` and `tempo` variables and drop the rest as there are the variables of interest that will be used for the analysis in **Section 2** and **Section 3**. Secondly, we remove all the rows with missing values and finally we join the two datasets together using a left join so that each song in the `taylor_album_songs` dataset can be associated/linked to its respective album names from `taylor_albums`, which faciliates a meaningful analysis. We store this transformed and cleaned version of the `taylor_album_songs` dataset joined with the `taylor_albums` dataset in a dataframe object called `df` which is the main data object that will be used in **Section 2** and **Section 3**.

```{r}
data <- tidytuesdayR::tt_load('2023-10-17')
cols_to_select <- c("album_name", "danceability", "energy", "loudness", "speechiness", "acousticness", "valence", "tempo")
>>>>>>> Arvind

taylor_albums <- data$taylor_albums

df <- data$taylor_album_songs %>% 
  select(all_of(cols_to_select)) %>% 
  drop_na() %>% 
  left_join(taylor_albums, by = "album_name") %>% 
  select(-c("ep"))
```

### Exploratory Data Analysis
<<<<<<< HEAD
```{r}
glimpse(df)

# looking at distribution of all data
dist <- df %>% 
  select(where(is.numeric)) %>% 
  pivot_longer(cols = everything(), names_to = "var", values_to = "val") %>%
  ggplot(aes(x = val)) +
  geom_histogram(bins = 30) +
  labs(title = "Distribution of All Numeric Variables") +
  theme_bw() +
  facet_wrap(~var, scales = "free") +
  theme(
    plot.title = element_text(hjust = 0.5),
    axis.title.x = element_blank(),
    axis.title.y = element_blank()
    )

# finding outliers
outliers <- df %>%
  select(where(is.numeric)) %>%
  pivot_longer(cols = everything(), names_to = "var", values_to = "val") %>%
  ggplot(aes(x = var, y = val)) +
  geom_boxplot() +
  labs(title = "Boxplot for Potential Outliers in Taylor Swift's Songs") +
  theme_bw() +
  facet_wrap(~var, scales = "free") +
  theme(
    plot.title = element_text(hjust = 0.5),
    axis.title.x = element_blank(),
    axis.title.y = element_blank()
    )

heatmap <- df %>%
  select(where(is.numeric)) %>%
  cor() %>%
  as.data.frame() %>% 
  rownames_to_column(var = "x") %>%
  pivot_longer(cols = -x, names_to = "y", values_to = "value") %>%
  ggplot(aes(x = x, y = y, fill = value)) +
  geom_tile(color = "black") +
  labs(title = "Correlation Heatmap of Numerical Variables", x = "", y = "")
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
    plot.title = element_text(hjust = 0.5)
  ) 
```

### Question 1
### Write question here
=======
This portion comprises the exploratory data analysis that computes key summary statistics to ascertain the key characteristics and features of the dataset stored in `df`. 
>>>>>>> Arvind
```{r}
glimpse(df)

# looking at distribution of all data
dist <- df %>% 
  select(where(is.numeric)) %>% 
  pivot_longer(cols = everything(), names_to = "var", values_to = "val") %>%
  ggplot(aes(x = val)) +
  geom_histogram(bins = 30) +
  labs(title = "Distribution of All Numeric Variables") +
  theme_bw() +
  facet_wrap(~var, scales = "free") +
  theme(
    plot.title = element_text(hjust = 0.5),
    axis.title.x = element_blank(),
    axis.title.y = element_blank()
    )

# finding outliers
outliers <- df %>%
  select(where(is.numeric)) %>%
  pivot_longer(cols = everything(), names_to = "var", values_to = "val") %>%
  ggplot(aes(x = var, y = val)) +
  geom_boxplot() +
  labs(title = "Boxplot for Potential Outliers in Taylor Swift's Songs") +
  theme_bw() +
  facet_wrap(~var, scales = "free") +
  theme(
    plot.title = element_text(hjust = 0.5),
    axis.title.x = element_blank(),
    axis.title.y = element_blank()
    )

heatmap <- df %>%
  select(where(is.numeric)) %>%
  cor() %>%
  as.data.frame() %>% 
  rownames_to_column(var = "x") %>%
  pivot_longer(cols = -x, names_to = "y", values_to = "value") %>%
  ggplot(aes(x = x, y = y, fill = value)) +
  geom_tile(color = "black") +
  labs(title = "Correlation Heatmap of Numerical Variables", x = "", y = "")
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
    plot.title = element_text(hjust = 0.5)
  ) 
```

<<<<<<< HEAD
### Question 2
### Write question here
```{r}
best_albums = c("folklore", "Red (Taylor's Version)")
worst_albums = c("reputation", "Taylor Swift")
=======
## Section 1

### Visualization 1 (Line Chart Version)
*Line chart that plots the metacritic score as well as user score of each Taylor Swift album in the y axis against the album release date on the X axis*

**Part 1 : Data Transformation**

We will use only the `taylor_albums` dataset for this part and will remove the rows with missing values. Additionally we will scale the user scores to be weighted out of 100 by multiplying the `user_score` variable by 10 (as it is originally weighted on a scale of 1-10)
```{r}
# create a dataframe df to use for plots and analysis in this section 
df_line <- drop_na(taylor_albums)
# scale the user_score variable
df_line$user_score <- df_line$user_score * 10
df_line

>>>>>>> Arvind

qn2 = df %>%
  filter(album_name == best_albums[1]
         | album_name == best_albums[2]
         | album_name == worst_albums[1]
         | album_name == worst_albums[2]) %>%
  group_by(album_name) %>%
  summarize(danceability = mean(danceability), energy = mean(energy),
            loudness_14_LUFS = mean(loudness) + 14, speechiness = mean(speechiness),
            acousticness = mean(acousticness), liveness = mean(liveness),
            valence = mean(valence), tempo = mean(tempo)) %>%
  gather(key = "feature",
         value = "mean_values",
         danceability:tempo)

ggplot(qn2, aes(x = album_name, y = mean_values, fill = album_name)) +
  geom_bar(stat = "identity") +
  facet_wrap(~ feature, scales = "free") + 
  theme_minimal() +
  theme(
    axis.text.x = element_blank(),
    axis.title.x = element_blank(),
    axis.title.y = element_blank()
  ) +
  ggtitle( "Values of features from albums") +
  scale_fill_viridis(discrete = TRUE)
```

<<<<<<< HEAD
### Question 3
Density plot that visualizes the distribution of energy in albums from the Top 2 Albums (based on metacritic and user scores) and a specific album (in this case, Taylor Swift)
```{r}
top_2_albums <- c("Red (Taylor's Version)", "folklore")

best_album_data <- df %>%
  filter(album_name %in% top_2_albums) %>%
  mutate(label = "Top 2 Albums")

=======
**Part 2 : Line Chart**

Using the transformed data above that is stored in the dataframe `df`, we now plot the line chart 
```{r}
ggplot(df_line) + 
  geom_line(aes(x = album_release, y = metacritic_score), color = "blue", size = 2) + 
  geom_line(aes(x = album_release, y = user_score), color = "gold", size = 2) + 
  labs(title = "Metacritic and User Score of Taylor Swift Albums", 
       x = "Album Release Date", y = "Score (out of 100)") 
  
```
### Visualization 1 (Bar Plot Version)
Bar graph that plots the values of metacritic score and user score of each taylor swift album

**Part 1: Data Transformation** 

We will use only the `taylor_albums` dataset for this part and as a part of the data transformation and cleaning we will perform the following steps:

1. we will remove the rows with missing values

2. we remove the albums "Fearless" and "Red" from this data and this analysis due to the fact that these albums are not present in the `taylor_album_songs` dataset, which will be used in for visualizations and analysis in subsequent sections

3. we will scale the user scores to be weighted out of 100 by multiplying the `user_score` variable by 10 (as it is originally weighted on a scale of 1-10)

4. we will use the `pivot_longer` function to tidy the `df` dataframe into a longer format, since in the original `taylor_albums` dataset, the column headers of the variables `metacritic_score` and `user_score` are actually values that we would like to use in this bar plot visualization to distinctly illustrate the metacritic and user scores separately. We create the new variables `score_type` and `score` to store the type (metacritic or user) of score and the value of the score (weighted out of 100) respectively

```{r}
# create a dataframe df_plot1 to use for the visualization and analysis in this section
df_plot1 <- drop_na(taylor_albums)
# remove the albums "Fearless" and "Red"
df_plot1 <- df_plot1 %>% filter(!((album_name == "Fearless")|(album_name == "Red")))
# scale the user scores to be weighted out of 100
df_plot1$user_score <- df_plot1$user_score * 10
# tidy the data
df_plot1 <- df_plot1 %>% pivot_longer(`metacritic_score`:`user_score`, names_to = "score_type", values_to = "score")
df_plot1

```

**Part 2: Bar Plot**

Using the fully transformed and cleaned version of the `taylor_albums` dataset which is now stored in the dataframe `df_plot1`, we now plot the bar chart using the `geom_col` function. For this visualization we use the variables `album_names`, `score` and `score_type`. The rationale behind choosing a bar plot for this visualization is that it allows our readers to not only view the metacritic and user scores of each albums more vividly, but it also enables them to compare these scores side by side in an easier and comprehensible manner due to the presence of distinct bars for both the metacritic and user score of each album respectively.This will facilitate the readers to ascertain which albums will be used in the subsequent sections. 
```{r}
ggplot(df_plot1) +
  geom_col(aes(x = album_name, y = score, fill = score_type), position = "dodge") +
  labs(title = "Metacritic and User Score of Taylor Swift Albums",
       x = "Album Names",
       y = "Score (weighted out of 100)" ) +
  scale_fill_viridis(option = "viridis", discrete = TRUE) +
  theme(axis.text.x = element_text(angle = 90)) +
  geom_text(aes(x = album_name, y = score, label = score), 
            position = position_dodge(width = 0.9),
            vjust = -0.25)
```

**Part 3: Insights from Visualization 1**

## Section 2

### Visualization 2 (Jeremy's Version)
Scatter chart that plots the numerical values of the features of each song in 4 different Taylor Swift albums- the 2 highest rated albums and the 2 lowest rated albums.

**Part 1: Scatter Plot**

Using the fully transformed and cleaned version of the `taylor_album_songs` dataset joined with `taylor_albums` dataset which is now stored in the dataframe `df`, we now plot the scatter chart using the `geom_point` function. For this visualization we use the variables `acousticness`, `danceability`, `energy`, `liveness`, `loudness`, `speechiness`, `tempo` and `valence` and compare these song features across the 4 chosen albums 
```{r}
taylor_albums %>% arrange(desc(metacritic_score),desc(user_score))

top_two_album = c("Red (Taylor's Version)", "folklore")
btm_two_album = c("reputation", "Taylor Swift")

df_plot2 <- df %>% select(album_name:tempo, user_score) %>% 
  filter(album_name %in% top_two_album | album_name %in% btm_two_album) %>%
  pivot_longer(cols= danceability:tempo, names_to = "features", values_to = "score") %>% 
  mutate(features = str_to_title(features), album_name = str_to_title(album_name))

ggplot(df_plot2, aes(x = album_name, y = score, color = album_name)) +
  geom_point(size = 2, alpha = 0.5) + 
  scale_fill_viridis(option = "viridis", discrete = TRUE) +
  facet_wrap(~ features, scales = "free") + 
  theme(axis.text.x = element_blank()) +
  labs(title = "Characteristics of Taylor's Top and Bottom 2 Albums Based on User Scores", x = "", y = "Score", color = "Album")


```

**Part 2: Insights from Visualization 2**

It can be seen that the four albums sometimes display noticeable features in the variables that sets it apart from the others, while other times there does not seem to be a clear difference between them. For example, Taylor's Swift's best album, 'Folklore', has considerably higher acousticness in general compared to the others. We can also notice that the 2 worst albums is generaly louder and has more energy than the 2 best albums. However, there does not seem to be any noticeable difference in tempo distribution among the songs in each of the four albums.

This shows that while some variables has a visible correlation to whether an album is perceived as good or bad, there are also other variables that might not have any effect on them.


## Section 3

### Visualization 3: 
**Part 1: Density Plot**

Density plot that visualizes the distribution of energy in albums from the Top 2 Albums (based on metacritic and user scores) and a specific album (in this case, Taylor Swift)
```{r}
top_2_albums <- c("Red (Taylor's Version)", "folklore")

best_album_data <- df %>%
  filter(album_name %in% top_2_albums) %>%
  mutate(label = "Top 2 Albums")

>>>>>>> Arvind
album_to_compare <- "1989"
selected_album_data <- df %>%
  filter(album_name == album_to_compare) %>%
  mutate(label = album_to_compare)

data_to_plot <- bind_rows(best_album_data, selected_album_data)

ggplot(data_to_plot, 
       aes(x = energy, fill = label, color = label)) +
  geom_density(alpha = 0.5) +
  labs(title = paste("Energy Distribution of Top 2 Albums VS", album_to_compare, "Album"),
       x = "Energy",
       y = "Density") +
  theme_bw() +
  theme(
    plot.title = element_text(hjust = 0.5),
    legend.position = "bottom"
    )
```
<<<<<<< HEAD
=======

**Part 2: Insights from Visualization 3**
>>>>>>> Arvind
